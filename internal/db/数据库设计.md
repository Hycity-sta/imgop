# 用户集合
``` json
{
  _id: ObjectId("..."), // 用户ID
  username: "alice123", // 用户名（唯一）
  email: "alice@example.com", // 邮箱（唯一）
  passwordHash: "hashed_password", // 加密后的密码
  displayName: "Alice", // 显示名称
  avatar: "https://.../avatar.jpg", // 头像URL
  status: "online", // online/offline/away/busy
  lastSeen: ISODate("2023-10-01T08:30:00Z"), // 最后在线时间
  createdAt: ISODate("2023-01-01T00:00:00Z"), // 创建时间
  updatedAt: ISODate("2023-10-01T08:30:00Z") // 最后更新时间
}
```

# 消息集合
``` json
{
  _id: ObjectId("..."), // 消息ID
  conversationId: ObjectId("..."), // 所属会话ID
  senderId: ObjectId("..."), // 发送者ID
  content: "Hello there!", // 消息内容
  contentType: "text", // text/image/video/file/link
  attachments: [
    {
      type: "image",
      url: "https://.../photo.jpg",
      size: 1024,
      name: "photo.jpg"
    }
  ],
  readBy: [ObjectId("..."), ObjectId("...")], // 已读用户ID列表
  createdAt: ISODate("2023-10-01T08:30:00Z"), // 发送时间
  updatedAt: ISODate("2023-10-01T08:30:00Z") // 最后更新时间
}
```


# 会话集合
``` json
{
  _id: ObjectId("..."), // 会话ID
  type: "private", // private/group
  participants: [ObjectId("..."), ObjectId("...")], // 参与者ID列表
  name: "Team Chat", // 群聊名称（如果是群聊）
  description: "Project discussion", // 群聊描述
  createdBy: ObjectId("..."), // 创建者ID
  admins: [ObjectId("...")], // 管理员列表（群聊）
  avatar: "https://.../group.jpg", // 群聊头像
  lastMessage: ObjectId("..."), // 最后一条消息ID
  createdAt: ISODate("2023-01-01T00:00:00Z"), // 创建时间
  updatedAt: ISODate("2023-10-01T08:30:00Z") // 最后更新时间
}
```


# 用户会话关联
``` json
{
  _id: ObjectId("..."),
  userId: ObjectId("..."), // 用户ID
  conversationId: ObjectId("..."), // 会话ID
  unreadCount: 3, // 未读消息数
  isMuted: false, // 是否静音
  isPinned: true, // 是否置顶
  lastReadMessage: ObjectId("..."), // 最后阅读的消息ID
  createdAt: ISODate("2023-01-01T00:00:00Z"),
  updatedAt: ISODate("2023-10-01T08:30:00Z")
}
```


# 索引设计
``` javascript
// 用户集合索引
db.users.createIndex({ username: 1 }, { unique: true });
db.users.createIndex({ email: 1 }, { unique: true });
db.users.createIndex({ status: 1 });

// 消息集合索引
db.messages.createIndex({ conversationId: 1, createdAt: -1 });
db.messages.createIndex({ senderId: 1 });
db.messages.createIndex({ createdAt: -1 });

// 会话集合索引
db.conversations.createIndex({ participants: 1 });
db.conversations.createIndex({ type: 1 });
db.conversations.createIndex({ lastMessage: 1 });

// 用户会话关联索引
db.user_conversations.createIndex({ userId: 1, conversationId: 1 }, { unique: true });
db.user_conversations.createIndex({ userId: 1, updatedAt: -1 });
```